---
title: js学习 --- 闭包
summary: 对于闭包的一些简单理解
date: 2022-05-21 13:09:55
tags: ['闭包']
categories: ['JavaScript']
---

# 闭包

## 作用域

作用域是指程序源代码中定义的范围，规定了如何设置变量，也就是确定当前执行代码对变量的访问权限，JavaScript采用词法作用域，也就是静态作用域

> 词法作用域在函数定义的时候就已经确定了

```js
let value = 1
function get() {
    console.log(value);
}
function getFn() {
    let value = 2
    get()
}
getFn() // 1
```

+ ### 变量对象

变量对象是在当前代码段中，所有的变量（变量、函数、形参arguments）组成的一个对象

变量对象是在执行上下文中被激活的，只有变量对象被激活了，在这段代码中才能使用所有的变量

变量对象分为全局变量对象和局部变量对象

全局简称为：Variable Object，函数执行激活的变量对象称为：Active Object

## 作用域链

在JavaScript中，函数存在一个隐式属性[[scopes]],这个属性用来保存当前函数的执行上下文环境，由于在数据结构上是链式的，因此也被称作是作用域链。

作用域链是变量对象的集合 就是变量对象组成的链式结构

+ ### 作用域链作用

保证执行环境里有权访问的变量和函数是有序的，作用域链的变量只能向上访问，变量访问到window对象即被终止，作用域链向下访问变量是不被允许的。

## 闭包是什么

闭包是一个没有释放资源的栈区，它存储了一个函数和一个关联的环境（执行上下文）

## 闭包的形成

1. 内部函数的函数体（作用域）中可以访问它们所在的外部函数作用域中所声明的所有局部变量、参数和声明的其他内部函数（基于作用域链访问）。

2. 当这个内部函数在包含它们的外部函数之外被调用时，就会形成闭包。

   ::: warning 个人见解

   个人认为，并不是只在函数中会形成闭包，只要是内部的块级作用域引用到了外部的块作用域，并且使得外部作用域中的引用无法释放，就会形成闭包。

   :::

## 闭包的作用
可以让局部变量的值始终保持在内存中；对内部变量进行保护，使外部访问不到
> 应用：[函数节流和防抖](./DebounceThrottling.md)
## 缺点
不合理的使用闭包，会造成内存泄露(就是该内存空间使用完毕之后未被回收)

## 使用示例
```javascript
for (var i = 0; i < 5; i++) {
   setTimeout(function() {
    console.log(i); // 1s后打印出5个5
   }, 1000);
}

//利用闭包，将上述题目改成1s后，打印0,1,2,3,4
for (var i = 0; i < 5; i++) {
   (function(j) {
      setTimeout(function () {
        console.log(j);
      }, 1000);
   })(i);
}
```

